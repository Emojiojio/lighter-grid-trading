# Lighter 交易所网格交易策略 - 使用指南

## 📋 目录
1. [快速开始](#快速开始)
2. [详细步骤](#详细步骤)
3. [配置说明](#配置说明)
4. [常见问题](#常见问题)

---

## 🚀 快速开始

### 第一步：进入项目目录
```bash
cd /Users/flock-studio/Documents/lighter-grid-trading
```

### 第二步：安装依赖
```bash
pip3 install -r requirements.txt
```

### 第三步：运行一键脚本
```bash
chmod +x run.sh
./run.sh
```

然后选择：
- **选项 1**：配置策略参数（首次使用）
- **选项 2**：启动网格交易策略

---

## 📝 详细步骤

### 1. 首次配置

#### 方法 A：使用一键脚本（推荐）
```bash
./run.sh
# 选择选项 1
```

#### 方法 B：直接运行配置脚本
```bash
python3 interactive_setup.py
```

#### 配置流程：

**步骤 1：配置 API 凭证**
- 系统会提示您输入 Lighter 交易所的 API 信息
- **API Key**: 您的 Lighter API 密钥
- **API Secret**: 您的 Lighter API 密钥
- **API Base URL**: 通常使用默认值即可

**步骤 2：配置交易参数**

1. **选择交易对**
   ```
   请输入交易对: BTC/USDT
   ```
   - 示例：`BTC/USDT`、`ETH/USDT`、`SOL/USDT`
   - 格式：`基础货币/计价货币`

2. **设置网格区间**
   ```
   请输入网格下限价格: 40000
   请输入网格上限价格: 50000
   ```
   - 下限价格 < 上限价格
   - 建议：根据当前价格设置合理的区间

3. **设置网格数量**
   ```
   请输入网格数量 (建议 5-50): 20
   ```
   - 网格越多，订单越密集，需要更多资金
   - 建议范围：5-50

4. **设置杠杆倍数**
   ```
   请输入杠杆倍数 (1-10，输入1表示不使用杠杆): 3
   ```
   - 1 = 不使用杠杆
   - 杠杆越高风险越大
   - 建议：1-5倍

5. **设置开仓价值**
   ```
   请输入每个网格的开仓价值 (USDT): 100
   ```
   - 每个网格订单的价值
   - 建议：至少 10 USDT

**步骤 3：确认配置**
- 系统会显示策略预览
- 确认后配置会自动保存

### 2. 启动策略

#### 方法 A：使用一键脚本
```bash
./run.sh
# 选择选项 2
```

#### 方法 B：直接运行主程序
```bash
python3 main.py
```

#### 运行说明：
- 策略会自动获取当前价格
- 在当前价格下方设置买入订单
- 在当前价格上方设置卖出订单
- 每 60 秒检查一次订单状态
- 按 `Ctrl+C` 停止策略

---

## ⚙️ 配置说明

### 配置文件位置
所有配置保存在：`config.json`（不会上传到 GitHub）

### 配置文件结构
```json
{
    "api_key": "您的API密钥",
    "api_secret": "您的API密钥",
    "base_url": "https://api.lighter.xyz",
    "network": {
        "timeout": 30,        // 请求超时时间（秒）
        "max_retries": 3,     // 最大重试次数
        "retry_backoff": 0.5  // 重试退避系数
    },
    "trading": {
        "symbol": "BTC/USDT",
        "lower_price": 40000,
        "upper_price": 50000,
        "grid_count": 20,
        "leverage": 3,
        "order_value": 100
    }
}
```

### 修改配置

#### 方法 1：重新运行配置脚本
```bash
python3 interactive_setup.py
```

#### 方法 2：直接编辑配置文件
```bash
# 使用文本编辑器打开
nano config.json
# 或
open -a TextEdit config.json
```

⚠️ **注意**：直接编辑时请确保 JSON 格式正确

### 网络配置（可选）

如果您的网络不稳定，可以调整网络参数：

```json
{
    "network": {
        "timeout": 60,        // 增加超时时间
        "max_retries": 5,     // 增加重试次数
        "retry_backoff": 1.0  // 增加重试间隔
    }
}
```

---

## 📊 策略工作原理

### 网格交易逻辑

1. **价格区间划分**
   - 根据您设置的上限和下限价格
   - 平均分成 N 个网格（N = 网格数量）

2. **订单分布**
   - **买入订单**：设置在当前价格下方的网格价格点
   - **卖出订单**：设置在当前价格上方的网格价格点

3. **自动执行**
   - 当价格下跌到某个网格价格时，买入订单成交
   - 当价格上涨到某个网格价格时，卖出订单成交
   - 策略会自动在成交位置重新设置订单

### 示例

假设：
- 当前价格：45000 USDT
- 网格区间：40000 - 50000
- 网格数量：10

网格价格点：
```
40000, 41000, 42000, 43000, 44000, 45000, 46000, 47000, 48000, 49000, 50000
```

订单设置：
- **买入订单**：40000, 41000, 42000, 43000, 44000
- **卖出订单**：46000, 47000, 48000, 49000, 50000

---

## 🔧 常见问题

### Q1: 提示"未找到 API 凭证"
**A:** 运行配置脚本设置 API 凭证
```bash
python3 interactive_setup.py
```

### Q2: 提示"未找到交易配置"
**A:** 运行配置脚本设置交易参数
```bash
python3 interactive_setup.py
```

### Q3: 网络连接失败
**A:** 
1. 检查网络连接
2. 调整 `config.json` 中的网络参数（增加超时和重试次数）
3. 检查 API Base URL 是否正确

### Q4: 下单失败
**A:**
1. 检查 API 密钥是否正确
2. 检查账户余额是否充足
3. 检查交易对名称是否正确
4. 查看日志了解具体错误信息

### Q5: 如何停止策略？
**A:** 按 `Ctrl+C`，策略会自动取消所有订单后退出

### Q6: 如何修改策略参数？
**A:** 重新运行配置脚本
```bash
python3 interactive_setup.py
```

### Q7: API 调用失败怎么办？
**A:** 
- 本项目中的 API 封装是基于通用结构编写的
- 您可能需要根据 Lighter 交易所的实际 API 文档调整 `lighter_api.py`
- 主要需要调整：API 端点、签名算法、请求格式

---

## 📁 项目文件说明

| 文件 | 说明 |
|------|------|
| `main.py` | 主程序入口，运行策略 |
| `interactive_setup.py` | 交互式配置脚本 |
| `grid_trading_strategy.py` | 网格交易策略核心逻辑 |
| `lighter_api.py` | Lighter API 封装（含网络优化） |
| `config.py` | 配置管理模块 |
| `run.sh` | 一键启动脚本 |
| `requirements.txt` | Python 依赖包 |
| `config.json` | 配置文件（自动生成，不提交到 Git） |
| `README.md` | 项目文档 |

---

## ⚠️ 重要提示

### 风险警告
- ⚠️ 网格交易策略存在市场风险，请谨慎使用
- ⚠️ 建议先用小额资金测试策略
- ⚠️ 杠杆交易风险更大，请根据自身风险承受能力设置
- ⚠️ 本工具仅供学习参考，使用需自行承担风险

### 使用建议
1. **首次使用**：先用小额资金测试
2. **参数设置**：根据市场波动性调整网格区间和数量
3. **监控策略**：定期检查策略运行状态
4. **网络稳定**：确保网络连接稳定，避免订单失败

---

## 🆘 获取帮助

如果遇到问题：
1. 查看日志输出了解详细错误信息
2. 检查 `config.json` 配置是否正确
3. 确认 Lighter 交易所 API 是否正常
4. 根据错误信息调整网络配置参数

---

## 📝 更新日志

### v1.0.0
- ✅ 实现完整的网格交易策略
- ✅ 交互式配置界面
- ✅ 网络优化（重试机制、超时控制）
- ✅ 自动监控和订单管理

---

祝您交易顺利！🎉

