# Lighter 交易所网格交易策略

一个用于 Lighter 交易所的自动化网格交易策略工具，支持交互式配置和自动化交易。

## 功能特点

- 🖥️ **图形界面**: 提供友好的图形化操作界面，支持可视化配置和运行
- 🎯 **交互式配置**: 通过图形界面或命令行轻松配置交易参数
- 📊 **网格交易**: 在指定价格区间内自动设置买入和卖出订单
- ⚙️ **灵活参数**: 支持自定义标的、网格区间、网格数量、杠杆和开仓价值
- 🔄 **自动监控**: 自动监控订单状态并重新下单
- 💾 **配置保存**: 自动保存配置，方便重复使用
- 🌐 **网络优化**: 内置重试机制、超时控制和连接池，适应不稳定网络环境

## 快速开始

### 1. 克隆仓库

```bash
git clone <your-repo-url>
cd lighter-grid-trading
```

### 2. 安装依赖

```bash
pip3 install -r requirements.txt
```

### 3. 启动程序

**方式 1：图形界面（推荐）**

```bash
# 使用一键脚本
./run.sh
# 选择选项 1：启动图形界面

# 或直接启动图形界面
./start_gui.sh
# 或
python3 gui.py
```

**方式 2：命令行界面**

```bash
# 使用一键脚本
./run.sh
# 选择选项 2 或 3

# 或直接运行
python3 interactive_setup.py  # 配置
python3 main.py               # 运行策略
```

## 使用说明

### 图形界面使用（推荐）

1. **启动图形界面**
   ```bash
   ./start_gui.sh
   # 或
   python3 gui.py
   ```

2. **配置 API 凭证**
   - 切换到 "API 配置" 标签页
   - 输入您的 Lighter API Key 和 Secret
   - 点击 "保存 API 配置"

3. **配置交易参数**
   - 切换到 "交易配置" 标签页
   - 填写交易对、网格区间、网格数量、杠杆倍数、开仓价值
   - 点击 "预览策略" 查看策略摘要
   - 点击 "保存交易配置"

4. **运行策略**
   - 切换到 "策略运行" 标签页
   - 点击 "启动策略" 按钮
   - 查看运行状态和策略信息
   - 切换到 "运行日志" 标签页查看详细日志
   - 点击 "停止策略" 停止运行

### 命令行使用

运行配置脚本后，您需要设置以下参数：

1. **交易对 (Symbol)**: 选择要交易的标的，如 `BTC/USDT`、`ETH/USDT` 等
2. **网格区间**: 设置价格的上限和下限
3. **网格数量**: 在区间内划分的网格数量（建议 5-50）
4. **杠杆倍数**: 交易杠杆（1-10，1 表示不使用杠杆）
5. **开仓价值**: 每个网格订单的名义价值（USDT，未乘以杠杆）

**重要说明 - 开仓价值与杠杆的关系：**
- 开仓价值是**名义价值**，表示每个网格订单的名义交易金额
- 实际需要的**保证金** = 开仓价值 / 杠杆倍数
- 例如：100 USDT 开仓价值，3x 杠杆 = 33.33 USDT 实际保证金

### 配置示例

```
交易对: BTC/USDT
网格区间: 40000 - 50000
网格数量: 20
杠杆倍数: 3x
每网格开仓价值: 100 USDT (名义价值)
实际保证金: 33.33 USDT (100 / 3)
```

### API 配置

首次使用时，系统会提示您输入 Lighter 交易所的 API 凭证：
- API Key
- API Secret
- API Base URL（可选，有默认值）

这些信息会保存在 `config.json` 文件中（已加入 .gitignore，不会上传到 GitHub）。

### 网络配置（可选）

如果您的网络环境不稳定，可以在 `config.json` 中配置网络参数：

```json
{
    "network": {
        "timeout": 30,        // 请求超时时间（秒），默认30秒
        "max_retries": 3,     // 最大重试次数，默认3次
        "retry_backoff": 0.5  // 重试退避系数（指数退避），默认0.5
    }
}
```

**网络优化特性**：
- ✅ 自动重试机制：网络错误时自动重试，使用指数退避策略
- ✅ 超时控制：避免请求无限等待
- ✅ 连接池管理：优化连接复用，提高效率
- ✅ 智能错误处理：区分可重试和不可重试的错误
- ✅ 详细日志：记录每次重试的详细信息

## 项目结构

```
.
├── gui.py                   # 图形界面程序
├── main.py                  # 主程序入口（命令行）
├── interactive_setup.py     # 交互式配置脚本（命令行）
├── grid_trading_strategy.py # 网格交易策略核心逻辑
├── lighter_api.py           # Lighter API 封装
├── config.py                # 配置管理模块
├── run.sh                   # 一键启动脚本
├── start_gui.sh            # 快速启动图形界面
├── requirements.txt         # Python 依赖
├── README.md               # 项目文档
└── .gitignore              # Git 忽略文件
```

## 重要提示

⚠️ **风险警告**:
- 网格交易策略存在市场风险，请谨慎使用
- 建议先用小额资金测试策略
- 杠杆交易风险更大，请根据自身风险承受能力设置
- 本工具仅供学习参考，使用需自行承担风险

⚠️ **API 适配**:
- 本项目中的 `lighter_api.py` 是基于通用 API 结构编写的
- 您可能需要根据 Lighter 交易所的实际 API 文档进行调整
- 主要需要调整的部分：
  - API 端点 URL
  - 签名算法
  - 请求/响应格式
  - 错误处理

## 工作原理

1. **网格生成**: 根据设定的价格区间和网格数量，计算每个网格的价格点
2. **订单生成**: 在当前价格下方设置买入订单，上方设置卖出订单
3. **自动下单**: 通过 API 自动提交所有网格订单
4. **监控调整**: 定期检查订单状态，必要时重新下单

## 开发说明

### 自定义 API 适配

如果 Lighter 交易所的 API 与当前实现不同，请修改 `lighter_api.py` 中的以下方法：

- `_generate_signature()`: 签名算法
- `get_ticker()`: 获取价格信息
- `place_order()`: 下单接口
- `cancel_order()`: 取消订单
- `get_open_orders()`: 获取未成交订单

### 扩展功能

可以在此基础上添加：
- 止损/止盈功能
- 策略回测
- 更多技术指标
- 邮件/短信通知
- Web 界面

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

## 联系方式

如有问题或建议，请通过 GitHub Issues 联系。

